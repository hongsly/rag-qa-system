# Generated by Claude Code
"""
Test with 3 RAG-focused queries to inspect the results (when queries match the corpus domain)
"""
from pathlib import Path
from src.hybrid_search import HybridRetriever


def test_rag_queries():
    project_root = Path(__file__).parent.parent
    data_dir = project_root / "data" / "processed"
    retriever = HybridRetriever()

    print("Loading index and chunks...", end=" ")
    retriever.load_from_file(data_dir / "rag_index.faiss", data_dir / "chunks.jsonl")
    print("done\n")

    # RAG-focused queries that should match corpus content
    rag_queries = [
        "What is dense passage retrieval?",
        "How does ColBERT work?",
        "What is the difference between sparse and dense retrieval?"
    ]

    for query in rag_queries:
        print("=" * 100)
        print(f"Query: {query}")
        print("=" * 100)

        dense_results = retriever.search_dense(query, 5)
        sparse_results = retriever.search_sparse(query, 5)
        hybrid_results = retriever.search_hybrid(query, 5)

        # Dense
        print("\nDENSE (FAISS) - Top 3:")
        print("-" * 100)
        for i, chunk in enumerate(dense_results[:3], 1):
            print(f"{i}. {chunk['chunk_id']}")
            print(f"   {chunk['chunk_text'][:200]}...\n")

        # Sparse
        print("SPARSE (BM25) - Top 3:")
        print("-" * 100)
        for i, chunk in enumerate(sparse_results[:3], 1):
            print(f"{i}. {chunk['chunk_id']}")
            print(f"   {chunk['chunk_text'][:200]}...\n")

        # Check overlap
        dense_ids = {c['chunk_id'] for c in dense_results}
        sparse_ids = {c['chunk_id'] for c in sparse_results}
        hybrid_ids = {c['chunk_id'] for c in hybrid_results}

        print("\nOVERLAP ANALYSIS:")
        print(f"  Dense âˆ© Sparse (top-5): {len(dense_ids & sparse_ids)}/5 chunks")
        print(f"  Dense IDs in Hybrid top-5: {len(dense_ids & hybrid_ids)}/5")
        print(f"  Sparse IDs in Hybrid top-5: {len(sparse_ids & hybrid_ids)}/5")

        print("\n")


if __name__ == "__main__":
    test_rag_queries()
